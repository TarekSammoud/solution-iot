@page "/systeme-partenaires/details/{id:guid}"
@using Application.DTOs
@using Application.DTOs.SystemePartenaire
@using Presentation.Web.Services
@inject SystemePartenaireApiService ApiService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>Détails Système Partenaire</PageTitle>

<h3>Détails Système Partenaire</h3>

@if (isLoading)
{
    <div class="text-center">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Chargement...</span>
        </div>
        <p>Chargement du système partenaire...</p>
    </div>
}
else if (systeme == null)
{
    <div class="alert alert-warning" role="alert">
        Le système partenaire n'existe pas.
    </div>
    <button class="btn btn-secondary" @onclick="BackToList">Retour à la liste</button>
}
else
{
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Erreur !</strong> @errorMessage
            <button type="button" class="btn-close" @onclick="() => errorMessage = null" aria-label="Close"></button>
        </div>
    }

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <a class="btn btn-warning me-2" href="/systeme-partenaires/edit/@systeme.Id">
                <span class="oi oi-pencil" aria-hidden="true"></span> Modifier
            </a>
            <a class="btn btn-danger" href="/systeme-partenaires/delete/@systeme.Id">
                <span class="oi oi-trash" aria-hidden="true"></span> Supprimer
            </a>
        </div>
        <button class="btn btn-secondary" @onclick="BackToList">
            <span class="oi oi-arrow-left" aria-hidden="true"></span> Retour
        </button>
    </div>

        <div class="card">
            <div class="card-header">
                <h5>Informations générales</h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">Nom</dt>
                    <dd class="col-sm-9">@systeme.Nom</dd>

                    <dt class="col-sm-3">URL de base</dt>
                    <dd class="col-sm-9">@systeme.UrlBase</dd>

                    <dt class="col-sm-3">UsernameAppel</dt>
                    <dd class="col-sm-9">@(!string.IsNullOrWhiteSpace(systeme.UsernameAppel) ? systeme.UsernameAppel : "—")</dd>

                    <dt class="col-sm-3">PasswordChiffre</dt>
                    <dd class="col-sm-9">@(!string.IsNullOrWhiteSpace(systeme.PasswordChiffre) ? "****" : "—")</dd>

                    <dt class="col-sm-3">UsernameAcces</dt>
                    <dd class="col-sm-9">@(!string.IsNullOrWhiteSpace(systeme.UsernameAcces) ? systeme.UsernameAcces : "—")</dd>

                    <dt class="col-sm-3">PasswordHashAcces</dt>
                    <dd class="col-sm-9">@(!string.IsNullOrWhiteSpace(systeme.PasswordHashAcces) ? "****" : "—")</dd>

                    <dt class="col-sm-3">Modes</dt>
                    <dd class="col-sm-9">
                        @if (systeme.EstAppelant)
                        {
                            <span class="badge bg-primary me-1">Appelant</span>
                        }
                        @if (systeme.EstAppele)
                        {
                            <span class="badge bg-success">Appelé</span>
                        }
                        @if (!systeme.EstAppelant && !systeme.EstAppele)
                        {
                            <span class="badge bg-secondary">Aucun</span>
                        }
                    </dd>

                    <dt class="col-sm-3">Actif</dt>
                    <dd class="col-sm-9">@(systeme.EstActif ? "Oui" : "Non")</dd>

                    <dt class="col-sm-3">Date de création</dt>
                    <dd class="col-sm-9">@systeme.DateCreation.ToString("dd/MM/yyyy HH:mm")</dd>
                </dl>
            </div>
        </div>
}

@code {
    [Parameter]
    public Guid Id { get; set; }

    private SystemePartenaireDto? systeme;
    private bool isLoading = true;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            systeme = await ApiService.GetByIdAsync(Id);
        }
        catch (Exception ex)
        {
            errorMessage = $"Erreur lors du chargement du système partenaire : {ex.Message}";
            Console.WriteLine($"Erreur lors du chargement: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }

    private void BackToList()
    {
        Navigation.NavigateTo("/systeme-partenaires");
    }
}
